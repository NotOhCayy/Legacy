<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SASP — Charge Calculator</title>
<style>
:root{
  --bg:#0f172a; --panel:#0b1220; --border:#1e293b; --muted:#94a3b8;
  --text:#e2e8f0; --accent:#38bdf8;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}
.header{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0b1220,#0a1020)}
.header img{width:36px;height:36px;border-radius:6px;border:1px solid var(--border)}
.header .title{font-weight:700}
.container{max-width:1100px;margin:0 auto;padding:16px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.25);padding:16px}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#0c162a;color:var(--text);cursor:pointer}
.btn:hover{border-color:#2e415b}
.btn-primary{background:var(--accent);color:#05121a;border-color:#2aa4db}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.input, select, textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0c162a;color:var(--text)}
textarea{min-height:220px;white-space:pre-wrap}
.small{font-size:12px;color:var(--muted)}
.footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:center}
hr{border:0;border-top:1px solid var(--border);margin:12px 0}
.badge{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:#0c162a;color:var(--muted);font-size:11px}

.layout{display:grid;grid-template-columns:340px 1fr;gap:16px}
@media (max-width:1000px){.layout{grid-template-columns:1fr}}
.list{max-height:420px;overflow:auto;border:1px solid var(--border);border-radius:12px}
.row{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;padding:10px;border-bottom:1px dashed var(--border)}
.code{font-weight:700;color:#7dd3fc}
.muted2{color:#a1a1aa;font-size:12px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.tag{display:inline-block;font-size:11px;padding:2px 6px;border-radius:6px;border:1px solid var(--border);background:#0c162a;margin-right:6px;margin-top:4px}
</style></head>
<body>
<header class="header">
  <img src="./assets/sasp_badge.png" alt="SASP badge"><div class="title">SASP — Charge Calculator</div>
  <a class="btn" style="margin-left:auto" href="./index.html">Back to Dashboard</a>
</header>
<main class="container">
  <div class="layout">
    <aside class="card">
      <input id="q" class="input" placeholder="Search (e.g., 304, robbery, weapons)" />
      <div id="catalog" class="list" style="margin-top:10px"></div>
      <h3 style="margin:12px 0 6px">Enhancements</h3>
      <div id="enh" class="list" style="padding:8px"></div>
    </aside>
    <section>
      <div class="card">
        <div class="grid2">
          <select id="officerSel"><option value="">Select callsign — name…</option></select>
          <input id="officer" class="input" placeholder="Officer / Callsign (editable)" />
        </div>
        <div id="chosen" class="list" style="margin-top:12px"></div>
        <div class="grid4" style="margin-top:12px">
          <div class="card"><div class="small">Total Time</div><div id="sumTime" style="font-size:18px"></div></div>
          <div class="card"><div class="small">Total Fine</div><div id="sumFine" style="font-size:18px"></div></div>
          <div class="card"><div class="small">Total Points</div><div id="sumPoints" style="font-size:18px"></div></div>
          <div class="card"><div class="small">Flags</div><div id="sumFlags" class="small"></div></div>
        </div>
      </div>
      <div class="card" style="margin-top:12px">
        <h3 style="margin:0 0 8px">Report</h3>
        <input id="suspect" class="input" placeholder="Suspect (optional)" />
        <textarea id="report" class="input" placeholder="Generated report will appear here…"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
          <button id="copy" class="btn">Copy</button>
          <button id="print" class="btn">Print</button>
        </div>
      </div>
      <div class="footer">Created by Maya Serrano | SASP Command</div>
    </section>
  </div>
</main>

<script id="rawLegal" type="text/plain">PASTE THE FULL LAW TEXT HERE (same format you sent). If you leave this empty, a minimal set of charges is loaded.</script>

<script>
const OFFICERS=[
  {"cs":"X-100","name":"Curtis Roscoe"},{"cs":"X-101","name":"Alexander Murphy"},
  {"cs":"A-110","name":"Maya Serrano"},{"cs":"A-111","name":"Max Callahan"},{"cs":"A-112","name":"Alexandr Nolan"},{"cs":"A-115","name":"Pepper Belle"},{"cs":"A-118","name":"Oscar Deacon"},
  {"cs":"C-123","name":"Hayley Cassidy"},{"cs":"C-134","name":"Jason Brennon"},
  {"cs":"LT-129","name":"Quintin Johnson"},{"cs":"LT-141","name":"Valentina Reyes"},{"cs":"LT-151","name":"Hamidi Aziz"},{"cs":"LT-153","name":"Joseph Dredd"},{"cs":"LT-162","name":"John Shepard"},{"cs":"LT-169","name":"Frank Hoight"},{"cs":"LT-180","name":"Nora Cipriano"},
  {"cs":"S-201","name":"Alexander Cappella"},{"cs":"S-202","name":"Justin North"},{"cs":"S-203","name":"Max Harris"},{"cs":"S-204","name":"Faye Howell"},{"cs":"S-205","name":"Timothy Martinez Jr"},{"cs":"S-206","name":"Louie Herrett"},{"cs":"S-207","name":"Romeo Vanderford"},{"cs":"S-218","name":"Ben Asher"},{"cs":"S-220","name":"Wes North"},{"cs":"S-227","name":"Lando Doe"},{"cs":"S-229","name":"Neon Cash"},{"cs":"S-239","name":"Dawid Odison"},{"cs":"S-255","name":"Brian O’connor II"},
  {"cs":"CO-301","name":"Saylor Ray"},{"cs":"CO-303","name":"Jason Wescott"},{"cs":"CO-305","name":"Julius Barry"},{"cs":"CO-309","name":"Eddie Irwin"},{"cs":"CO-310","name":"Belle French"},{"cs":"CO-311","name":"Jay Walken"},{"cs":"CO-312","name":"Timmy Hunter"},{"cs":"CO-313","name":"Doug Grayves"},{"cs":"CO-320","name":"Bo Stabler"},{"cs":"CO-321","name":"Travis Brewer"},{"cs":"CO-331","name":"Enzo Knight"},{"cs":"CO-333","name":"Del Powers"},{"cs":"CO-350","name":"Stevo Mayte"},{"cs":"CO-360","name":"Matthew Ramirez"},{"cs":"CO-369","name":"James Middleton"},{"cs":"CO-383","name":"Skeeter Woodhouse"},{"cs":"CO-395","name":"Ronny Roman"},
  {"cs":"SO-401","name":"Finley Maximoff"},{"cs":"SO-402","name":"Jerry Ward"},{"cs":"SO-404","name":"Joseph Randy"},{"cs":"SO-405","name":"Sebastian Collinsworth"},{"cs":"SO-406","name":"Ricky Mathers"},{"cs":"SO-407","name":"Sonny Sullivan"},{"cs":"SO-408","name":"Albus Davies"},{"cs":"SO-410","name":"Clint Morris"},{"cs":"SO-411","name":"Scarlett Rain"},{"cs":"SO-412","name":"Steven Wet"},{"cs":"SO-413","name":"Ralph Garza"},{"cs":"SO-414","name":"Aezlyn Soria"},{"cs":"SO-416","name":"Austin Crockett"},{"cs":"SO-419","name":"Kaleb Axel"},{"cs":"SO-420","name":"Juniper Rowan"},{"cs":"SO-429","name":"Dale Shields"},{"cs":"SO-440","name":"Dempsey Watson"},{"cs":"SO-443","name":"Street Frost"},{"cs":"SO-444","name":"Adam Ahmed"},{"cs":"SO-450","name":"Ava Valentine"},{"cs":"SO-459","name":"Jimmy Hoxton"},{"cs":"SO-469","name":"Jimmy Boudreaux"},{"cs":"SO-485","name":"Ralph Lawrence"},{"cs":"SO-488","name":"Marc Chevy"},{"cs":"SO-497","name":"Michigan Silver"},{"cs":"SO-498","name":"Jeremie Rodriguez Valentine"},
  {"cs":"O-501","name":"Casey Leclair"},{"cs":"O-505","name":"Justin Bleacher"},{"cs":"O-507","name":"Phil Eldwood"},{"cs":"O-509","name":"Jacob Page"},{"cs":"O-510","name":"Tommy Thibodeaux"},{"cs":"O-511","name":"Eevee Hunter"},{"cs":"O-520","name":"Lela Law"},{"cs":"O-521","name":"Aileen Callahan"},{"cs":"O-525","name":"Davie Smith"},{"cs":"O-530","name":"Aurora Bordeaux"},{"cs":"O-542","name":"Fredrick Oxmall"},{"cs":"O-545","name":"Michael Price"},{"cs":"O-550","name":"Lexie Rivers"},{"cs":"O-555","name":"Peter Dinklage"},{"cs":"O-559","name":"Misty Meanor"},
  {"cs":"PO-601","name":"Tommy Redwood"},{"cs":"PO-612","name":"Anakin Skywalker"},{"cs":"PO-616","name":"Derrick Stones"},{"cs":"PO-617","name":"Peach Cobbler"},{"cs":"PO-627","name":"Lily Cappella-beltz"},{"cs":"PO-660","name":"Elliot Grayson"},{"cs":"PO-666","name":"Benson Drake"},{"cs":"PO-669","name":"Kendrick Carter"},{"cs":"PO-670","name":"Ryan Gonzalez"},{"cs":"PO-677","name":"Eric Gunter"},{"cs":"PO-687","name":"Lewis Gallagher"}
];
const ENH=[
  {code:'P.C. 1101', name:'Accessory Before The Fact (ACC-BTF)', multiplier:1.25},
  {code:'P.C. 1102', name:'Accessory After The Fact (ACC-ATF)',  multiplier:1.75},
  {code:'P.C. 1103', name:'Aiding and Abetting (AAA)',           multiplier:2.00},
  {code:'P.C. 1104', name:'Applicability (APP)',                 multiplier:1.00},
  {code:'P.C. 1105', name:'Attempt (ATT)',                       multiplier:2.00},
  {code:'P.C. 1106', name:'Conspiracy (CON)',                    multiplier:2.00},
  {code:'P.C. 1107', name:'Soliciting (SOL)',                    multiplier:1.50},
  {code:'P.C. 1108', name:'Gang Enhancement (GE)',               multiplier:1.50},
  {code:'P.C. 1109', name:'Protected Persons (PP)',              multiplier:1.40},
  {code:'P.C. 1110', name:'Public Menace (PM)',                  multiplier:1.00, extraMonthsPer:600, configurable:true},
  {code:'P.C. 1111', name:'Intent to Sell (ITS)',                multiplier:1.50},
  {code:'P.C. 1112', name:'Protected Property (P-Prop)',         multiplier:1.20},
  {code:'P.C. 1113', name:'Deface Firearm (DFF)',                multiplier:1.00}
];
const $=s=>document.querySelector(s);
function populateCallsignSelect(sel){ if(!sel) return; sel.innerHTML='<option value="">Select callsign — name…</option>'; OFFICERS.forEach(o=>{const opt=document.createElement('option'); opt.value=`${o.cs} — ${o.name}`; opt.textContent=opt.value; sel.appendChild(opt);});}
// Parse raw block -> charges
function parseCharges(text){
  const lines=text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const out=[]; const codeRe=/^P\.C\.\s*\d+/i;
  for(let i=0;i<lines.length;i++){
    if(!codeRe.test(lines[i])) continue;
    const code=lines[i++];
    const name=lines[i++]||'';
    const def=lines[i++]||'';
    const timeRaw=(lines[i++]||'').toUpperCase();
    const fineRaw=(lines[i++]||'');
    const result=(lines[i++]||'-');
    let points=0;
    if(i<lines.length && /^\d+$/.test(lines[i])){ points=parseInt(lines[i],10); i++; }
    const time=(timeRaw==='HUT')?'HUT':parseInt((timeRaw||'0').replace(/[^\d]/g,''),10)||0;
    const fine=(fineRaw==='HUT')?'HUT':parseInt((fineRaw||'0').replace(/[^\d]/g,''),10)||0;
    out.push({code,name,definition:def,time,fine,result,points});
    i--; // compensate for for-loop increment
  }
  return out;
}
const RAW=document.getElementById('rawLegal').textContent||"";
let CHARGES = parseCharges(RAW);
if(!CHARGES.length){
  CHARGES=[
    {code:'P.C. 304',name:'Robbery',definition:'The unlawful taking of property from the person of another through the use of threat or force.',time:25,fine:400,result:'Seize',points:0},
    {code:'P.C. 305',name:'Armed Robbery',definition:'The unlawful taking of property by the use of a weapon.',time:40,fine:850,result:'Seize',points:0},
    {code:'P.C. 901',name:'Carrying a Firearm Without a License',definition:'Act of carrying a firearm without proper documentation.',time:25,fine:400,result:'Seize',points:0}
  ];
}
// State + UI
const state={selected:[], enh:new Set(), pmCount:0};
const currency=n=>`$${Number(n||0).toLocaleString()}`; const months=n=> (n==='HUT')?'HUT':`${n} months`;
function activeEnh(){return ENH.filter(e=>state.enh.has(e.code));}
function renderCatalog(){
  const q=$('#q').value.trim().toLowerCase(); const box=$('#catalog'); box.innerHTML='';
  CHARGES.filter(c=>!q||c.code.toLowerCase().includes(q)||c.name.toLowerCase().includes(q)||c.definition.toLowerCase().includes(q)).forEach(c=>{
    const row=document.createElement('div'); row.className='row';
    const left=document.createElement('div'); left.innerHTML=`<div><span class="code">${c.code}</span> — ${c.name}</div><div class="muted2">${c.definition}</div>`;
    const qty=document.createElement('input'); qty.type='number'; qty.min='1'; qty.value='1'; qty.className='input'; qty.style.width='70px';
    const btn=document.createElement('button'); btn.className='btn'; btn.textContent='Add'; btn.onclick=()=>addCharge(c.code, parseInt(qty.value||'1',10));
    row.append(left,qty,btn); box.appendChild(row);
  });
}
function addCharge(code,count){ const found=state.selected.find(x=>x.code===code); if(found) found.count+=count; else state.selected.push({code,count}); renderSelected(); }
function removeCharge(code){ state.selected=state.selected.filter(x=>x.code!==code); renderSelected(); }
function renderEnh(){
  const box=$('#enh'); box.innerHTML='';
  ENH.forEach(e=>{
    const d=document.createElement('div'); d.style.marginBottom='6px';
    const id='enh_'+e.code.replace(/\W/g,'_');
    d.innerHTML=`<label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="${id}"> <div><strong>${e.code}</strong> — ${e.name} <span class="tag">x${(e.multiplier||1).toFixed(2)}</span></div></label>`;
    const ck=d.querySelector('input'); ck.checked=state.enh.has(e.code);
    ck.addEventListener('change',()=>{ if(ck.checked) state.enh.add(e.code); else state.enh.delete(e.code); renderSelected(); renderEnh(); });
    if(e.code==='P.C. 1110'){ const extra=document.createElement('div'); extra.className='small'; extra.style.marginTop='4px'; extra.innerHTML=`Prior serious felonies: <input id="pmCount" type="number" min="0" value="${state.pmCount}" class="input" style="width:80px;display:inline-block;margin-left:6px">`; d.appendChild(extra); setTimeout(()=>{document.getElementById('pmCount').addEventListener('input',ev=>{ state.pmCount=parseInt(ev.target.value||'0',10); renderSelected();});},0); }
    box.appendChild(d);
  });
}
function calcTotals(){
  let monthsTot=0, fineTot=0, pointsTot=0, hut=false; const flags=new Set();
  state.selected.forEach(item=>{ const c=CHARGES.find(x=>x.code===item.code); if(!c) return; const cnt=item.count;
    const isHut=(String(c.time).toUpperCase()==='HUT'||String(c.fine).toUpperCase()==='HUT'); if(isHut) hut=true;
    const baseM=isHut?0:(Number(c.time)||0)*cnt; const baseF=isHut?0:(Number(c.fine)||0)*cnt;
    monthsTot+=baseM; fineTot+=baseF; pointsTot+=(Number(c.points)||0)*cnt;
    if((c.result||'').toLowerCase().includes('seize')) flags.add('Seize');
  });
  let mult=1.0; activeEnh().forEach(e=>mult*=(e.multiplier||1));
  monthsTot=Math.round(monthsTot*mult); fineTot=Math.round(fineTot*mult);
  if(state.enh.has('P.C. 1110') && state.pmCount>0) monthsTot+=600*state.pmCount;
  return {months:monthsTot,fine:fineTot,points:pointsTot,hut,flags:[...flags]};
}
function renderSelected(){
  const box=$('#chosen'); box.innerHTML='';
  if(!state.selected.length){ box.innerHTML='<div class="small">No charges selected.</div>'; }
  state.selected.forEach(item=>{
    const c=CHARGES.find(x=>x.code===item.code); if(!c) return;
    const r=document.createElement('div'); r.className='row';
    r.innerHTML=`<div><span class="code">${c.code}</span> — ${c.name}<div class="small">${c.definition}</div></div>
                 <input type="number" min="1" value="${item.count}" class="input" style="width:80px">
                 <button class="btn">✕</button>`;
    const qty=r.querySelector('input'); qty.addEventListener('input',()=>{ item.count=Math.max(1,parseInt(qty.value||'1',10)); updateTotalsAndReport(); });
    r.querySelector('button').addEventListener('click',()=>removeCharge(item.code));
    box.appendChild(r);
  });
  updateTotalsAndReport();
}
function updateTotalsAndReport(){
  const t=calcTotals();
  document.getElementById('sumTime').textContent=t.hut?'HUT':`${t.months} months`;
  document.getElementById('sumFine').textContent=currency(t.fine);
  document.getElementById('sumPoints').textContent=String(t.points);
  document.getElementById('sumFlags').textContent=t.flags.length? t.flags.join(', ') : 'None';
  const officer=document.getElementById('officer').value.trim();
  const suspect=document.getElementById('suspect').value.trim();
  const lines=[]; if(officer) lines.push(`Officer: ${officer}`); if(suspect) lines.push(`Suspect: ${suspect}`); if(lines.length) lines.push('');
  lines.push('Charges:');
  state.selected.forEach(item=>{ const c=CHARGES.find(x=>x.code===item.code); if(!c) return; lines.push(`- ${c.code} — ${c.name} x${item.count} (Time ${c.time==='HUT'?'HUT':c.time+' months'}, Fine ${currency(c.fine)}${c.points?`, Points ${c.points}`:''})`); });
  lines.push(''); lines.push(`Total Time: ${t.hut?'HUT':t.months+' months'}`); lines.push(`Total Fine: ${currency(t.fine)}`); lines.push(`Total Points: ${t.points}`); if(t.flags.length) lines.push(`Flags: ${t.flags.join(', ')}`);
  document.getElementById('report').value=lines.join('\n');
}
// Init
populateCallsignSelect(document.getElementById('officerSel'));
document.getElementById('officerSel').addEventListener('change',e=>{ document.getElementById('officer').value=e.target.value; updateTotalsAndReport(); });
document.getElementById('q').addEventListener('input',renderCatalog);
document.getElementById('officer').addEventListener('input',updateTotalsAndReport);
document.getElementById('suspect').addEventListener('input',updateTotalsAndReport);
document.getElementById('copy').addEventListener('click',()=>navigator.clipboard.writeText(document.getElementById('report').value).catch(()=>{}));
document.getElementById('print').addEventListener('click',()=>window.print());
renderCatalog(); renderEnh();
</script>
</body></html>
