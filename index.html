<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Incident Tools — Charge Calculator + Robbery Report</title>
  <style>
    :root{--bg:#0b0f16;--card:#111826;--muted:#93a1b1;--text:#e6edf3;--accent:#3b82f6;--line:#1f2937}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:16px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#0e1624,#0b0f16)}
    header h1{margin:0;font-size:20px}
    header p{margin:6px 0 0;color:var(--muted);font-size:13px}

    /* Tabs */
    .tabs{display:flex;gap:8px;padding:10px 16px;border-bottom:1px solid var(--line);background:#0d1422}
    .tab{padding:8px 12px;border:1px solid var(--line);border-bottom:none;border-radius:10px 10px 0 0;background:#0b1220;color:#cbd5e1;cursor:pointer}
    .tab.active{background:var(--accent);border-color:#2f66c5;color:#fff}

    main{padding:16px;max-width:1300px;margin:0 auto}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden}
    .panel h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--line);font-size:14px;color:#cbd5e1}
    .section{padding:12px 14px}
    input,select,button,textarea{font:inherit}
    input[type="text"], input[type="number"], select, textarea{width:100%;padding:8px 10px;border:1px solid #243042;background:#0d1422;color:var(--text);border-radius:10px}
    input::placeholder, textarea::placeholder{color:#64748b}
    .row{display:flex;gap:10px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .muted{color:var(--muted)}
    .btn{background:#0d1422;border:1px solid #20304d;color:#cbd5e1;border-radius:10px;padding:7px 10px;cursor:pointer}
    .btn:hover{border-color:#335a99}
    .btn-primary{background:var(--accent);border-color:#2f66c5;color:#fff}
    .sticky-footer{display:flex;gap:8px;justify-content:flex-end;padding:10px;border-top:1px solid var(--line);background:#0e1624;position:sticky;bottom:0}

    /* Calculator columns */
    .cols{display:grid;grid-template-columns:330px 1fr;gap:16px}
    @media (max-width:1000px){.cols{grid-template-columns:1fr}}
    .charges-list{max-height:360px;overflow:auto;border:1px solid var(--line);border-radius:10px}
    .charge-item{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;padding:8px 10px;border-bottom:1px dashed var(--line)}
    .code{font-weight:600;color:#93c5fd}
    .def{color:#93a1b1;font-size:12px}
    .tag{display:inline-block;font-size:11px;padding:2px 6px;border-radius:6px;border:1px solid var(--line);background:#0d1422;margin-right:6px;margin-top:4px}
    .selected-list{max-height:280px;overflow:auto;border:1px solid var(--line);border-radius:10px}
    .selected-row{display:grid;grid-template-columns:86px 1fr 100px 120px 70px 30px;gap:8px;align-items:center;padding:8px 10px;border-bottom:1px dashed var(--line)}
    .sum{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:8px}
    .card{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:10px}
    .small{font-size:12px}

    /* Robbery form */
    .rf-grid{display:grid;grid-template-columns:360px 1fr;gap:16px}
    @media (max-width:1000px){.rf-grid{grid-template-columns:1fr}}
    textarea#robReport{height:420px;white-space:pre-wrap}
  </style>
</head>
<body>
<header>
  <h1>Incident Tools</h1>
  <p class="muted">Charge Calculator + Robbery Incident Report (with dropdown names and selections). Autosave + URL prefill.</p>
</header>
<div class="tabs">
  <button class="tab active" data-tab="calc">Incident Charge Calculator</button>
  <button class="tab" data-tab="rob">Robbery Incident Report</button>
</div>
<main>
  <!-- ============= CALCULATOR TAB ============= -->
  <section id="tab-calc" class="panel">
    <h2>Charge Calculator</h2>
    <div class="section">
      <div class="cols">
        <aside>
          <div class="section" style="padding:0 0 12px 0">
            <input id="search" type="text" placeholder="Search code or name (e.g., 304, Robbery)" />
            <div class="charges-list" id="catalog" style="margin-top:8px"></div>
          </div>

          <h3 class="muted" style="margin:8px 0 6px">Enhancements</h3>
          <div class="section" id="enhancements" style="padding:0"></div>

          <div class="section" style="padding:12px 0 0">
            <button id="clearAll" class="btn">Clear selection</button>
            <button id="shareLink" class="btn">Share prefilled link</button>
          </div>
        </aside>

        <div>
          <div class="grid2">
            <select id="officerSelect"><option value="">Select callsign — name…</option></select>
            <input id="officer" type="text" placeholder="Officer/Callsign (editable)" />
          </div>

          <div class="selected-list" id="selected" style="margin-top:12px"></div>
          <div class="sum">
            <div class="card"><div class="muted small">Total Time</div><div id="sumTime" style="font-size:18px"></div></div>
            <div class="card"><div class="muted small">Total Fine</div><div id="sumFine" style="font-size:18px"></div></div>
            <div class="card"><div class="muted small">Total Points</div><div id="sumPoints" style="font-size:18px"></div></div>
            <div class="card"><div class="muted small">Flags</div><div id="sumFlags" class="small"></div></div>
          </div>

          <h3 style="margin:14px 0 6px">Report</h3>
          <div class="grid2">
            <input id="suspect" type="text" placeholder="Suspect name (optional)" />
          </div>
          <textarea id="report" class="card" placeholder="Generated report will appear here..."></textarea>
          <div class="sticky-footer">
            <button id="copy" class="btn">Copy</button>
            <button id="print" class="btn">Print</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ============= ROBBERY TAB ============= -->
  <section id="tab-rob" class="panel" style="display:none">
    <h2>Robbery Incident Report</h2>
    <div class="section rf-grid">
      <aside>
        <div class="grid2">
          <select id="robOfficerSel"><option value="">Select callsign — name…</option></select>
          <input id="robOfficer" type="text" placeholder="Your Callsign & Name (editable)" />
        </div>
        <div class="grid2" style="margin-top:8px">
          <select id="sceneCmd"><option value="">Scene command…</option></select>
          <select id="negotiator"><option value="">Negotiator…</option></select>
        </div>
        <select id="hostageBack" style="margin-top:8px"><option value="">Who stayed back for hostage…</option></select>

        <h3 style="margin:14px 0 6px">Pursuit Order</h3>
        <div class="grid2"><input id="primary" placeholder="Primary" /><input id="primaryPass" placeholder="Passenger" /></div>
        <div class="grid2" style="margin-top:6px"><input id="secondary" placeholder="Secondary" /><input id="secondaryPass" placeholder="Passenger" /></div>
        <div class="grid2" style="margin-top:6px"><input id="tertiary" placeholder="Tertiary" /><input id="tertiaryPass" placeholder="Passenger" /></div>
        <div class="grid2" style="margin-top:6px"><input id="parallel" placeholder="Parallel" /><input id="parallelPass" placeholder="Passenger" /></div>
        <div class="grid2" style="margin-top:6px"><input id="bike" placeholder="Bike-Unit (Optional)" /><input id="air1" placeholder="Air-1 (Optional)" /></div>
        <input id="air1Copilot" placeholder="Co-Pilot (Optional)" style="margin-top:6px" />

        <h3 style="margin:14px 0 6px">Robbery</h3>
        <div class="row" role="radiogroup" aria-label="Robbery Type">
          <label><input type="radio" name="robType" value="Jewelry Store"> Jewelry Store</label>
          <label><input type="radio" name="robType" value="Fleeca Bank"> Fleeca Bank</label>
          <label><input type="radio" name="robType" value="24/7 Store"> 24/7 Store</label>
        </div>
        <select id="whichFleeca" style="margin-top:8px;display:none">
          <option value="">Which Fleeca…</option>
          <option>Legion Square</option><option>Burton</option><option>Rockford Hills (Lifeinvader)</option><option>Alta</option><option>Great Ocean</option><option>Route 68</option>
        </select>
        <select id="which247" style="margin-top:8px;display:none">
          <option value="">Which 24/7…</option>
          <option>Strawberry 24/7</option><option>Davis LTD 24/7</option><option>Murrieta Heights Rob's Liquor</option><option>Little Seoul LTD 24/7</option><option>Vespucci Canals Rob's Liquor</option><option>Morningwood Rob's Liquor</option><option>Mirror Park LTD 24/7</option><option>Downtown Vinewood 24/7</option><option>Tataviam Mountains 24/7</option><option>Banham Canyon Rob's Liquor</option><option>Banham Canyon 24/7</option><option>Richman Glen LTD 24/7</option><option>Chumash 24/7</option><option>Harmony 24/7</option><option>Grand Senora 24/7</option><option>Grapeseed LTD 24/7</option><option>Mount Chilliad 24/7</option>
        </select>

        <div class="grid3" style="margin-top:8px">
          <label>Inside
            <select id="robInside"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select>
          </label>
          <label>Outside
            <select id="robOutside"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select>
          </label>
          <label>Hostages
            <select id="hostages"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select>
          </label>
        </div>

        <div style="margin-top:8px">
          <div class="muted" style="margin-bottom:4px">Demands</div>
          <label><input type="checkbox" class="demand" value="free passage with no spikes on perimeter"> free passage with no spikes on perimeter</label><br>
          <label><input type="checkbox" class="demand" value="free passage with no spikes on the whole chase"> free passage with no spikes on the whole chase</label><br>
          <label><input type="checkbox" class="demand" value="no helicopter"> no helicopter</label><br>
          <label><input type="checkbox" class="demand" value="no speed unit"> no speed unit</label><br>
          <label><input type="checkbox" class="demand" value="no bike unit"> no bike unit</label><br>
          <input id="demandOther" placeholder="Other (optional)" />
        </div>

        <h3 style="margin:14px 0 6px">Vehicle</h3>
        <input id="vehDesc" placeholder="Description" />
        <div class="grid3" style="margin-top:8px">
          <input id="vehColor" placeholder="Color" />
          <input id="vehPlate" placeholder="Plate" />
          <input id="vehRegTo" placeholder="Registered To" />
        </div>

        <h3 style="margin:14px 0 6px">Outcome</h3>
        <select id="ending"><option value="">How did the chase end?</option></select>
        <label style="margin-top:6px;display:block"><input id="caughtOnly" type="checkbox" /> Check this once they have been caught only!</label>
        <textarea id="endingCustom" placeholder="Write Custom Ending (optional)" style="margin-top:8px;height:92px"></textarea>

        <h3 style="margin:14px 0 6px">Medical & Processing</h3>
        <label><input id="medNeeded" type="checkbox"/> Medical attention needed</label>
        <div class="grid3" style="margin-top:6px">
          <label>Suspects <select id="medSus"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select></label>
          <label>Police <select id="medCop"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select></label>
          <label>Hospital <select id="hospital"><option>Saint Fiacre</option><option>Mount Zonah</option><option>Sandy Shores Medical</option><option>Paleto Hospital</option><option>Cayo Perico</option></select></label>
        </div>
        <label style="margin-top:6px;display:block"><input id="fleeHospital" type="checkbox"/> Attempted to flee at hospital</label>
        <div class="grid2" style="margin-top:8px">
          <select id="processedAt"><option>MRPD</option><option>Sandy Shores Sheriff's Office</option><option>Davis PD</option><option>Paleto Police Department</option><option>Highway Police Department</option></select>
          <label style="display:flex;align-items:center;gap:6px"><input id="pleadNC" type="checkbox"/> Plead no contest (optional)</label>
        </div>
      </aside>

      <section>
        <textarea id="robReport" class="card" placeholder="The report will appear here as you fill the form…"></textarea>
        <div class="sticky-footer">
          <button id="robShare" class="btn">Share prefilled link</button>
          <button id="robCopy" class="btn">Copy</button>
          <button id="robPrint" class="btn">Print</button>
        </div>
      </section>
    </div>
  </section>
</main>

<script>
/* ===== Shared callsigns ===== */
const OFFICERS=[
  {cs:'X-100',name:'Curtis Roscoe'},{cs:'X-101',name:'Alexander Murphy'},
  {cs:'A-110',name:'Maya Serrano'},{cs:'A-111',name:'Max Callahan'},{cs:'A-112',name:'Alexandr Nolan'},
  {cs:'A-115',name:'Pepper Belle'},{cs:'A-118',name:'Oscar Deacon'},
  {cs:'C-123',name:'Hayley Cassidy'},{cs:'C-134',name:'Jason Brennon'},
  {cs:'LT-129',name:'Quintin Johnson'},{cs:'LT-141',name:'Valentina Reyes'},{cs:'LT-151',name:'Hamidi Aziz'},
  {cs:'LT-153',name:'Joseph Dredd'},{cs:'LT-162',name:'John Shepard'},{cs:'LT-169',name:'Frank Hoight'},{cs:'LT-180',name:'Nora Cipriano'},
  {cs:'S-201',name:'Alexander Cappella'},{cs:'S-202',name:'Justin North'},{cs:'S-203',name:'Max Harris'},{cs:'S-204',name:'Faye Howell'},
  {cs:'S-205',name:'Timothy Martinez Jr'},{cs:'S-206',name:'Louie Herrett'},{cs:'S-207',name:'Romeo Vanderford'},
  {cs:'S-218',name:'Ben Asher'},{cs:'S-220',name:'Wes North'},{cs:'S-227',name:'Lando Doe'},{cs:'S-229',name:'Neon Cash'},
  {cs:'S-239',name:'Dawid Odison'},{cs:'S-255',name:"Brian O’Connor II"},
  {cs:'CO-301',name:'Saylor Ray'},{cs:'CO-303',name:'Jason Wescott'},{cs:'CO-305',name:'Julius Barry'},{cs:'CO-309',name:'Eddie Irwin'},
  {cs:'CO-310',name:'Belle French'},{cs:'CO-311',name:'Jay Walken'},{cs:'CO-312',name:'Timmy Hunter'},{cs:'CO-313',name:'Doug Grayves'},
  {cs:'CO-320',name:'Bo Stabler'},{cs:'CO-321',name:'Travis Brewer'},{cs:'CO-331',name:'Enzo Knight'},{cs:'CO-333',name:'Del Powers'},
  {cs:'CO-350',name:'Stevo Mayte'},{cs:'CO-360',name:'Matthew Ramirez'},{cs:'CO-369',name:'James Middleton'},
  {cs:'CO-383',name:'Skeeter Woodhouse'},{cs:'CO-395',name:'Ronny Roman'},
  {cs:'SO-401',name:'Finley Maximoff'},{cs:'SO-402',name:'Jerry Ward'},{cs:'SO-404',name:'Joseph Randy'},{cs:'SO-405',name:'Sebastian Collinsworth'},
  {cs:'SO-406',name:'Ricky Mathers'},{cs:'SO-407',name:'Sonny Sullivan'},{cs:'SO-408',name:'Albus Davies'},
  {cs:'SO-410',name:'Clint Morris'},{cs:'SO-411',name:'Scarlett Rain'},{cs:'SO-412',name:'Steven Wet'},{cs:'SO-413',name:'Ralph Garza'},
  {cs:'SO-414',name:'Aezlyn Soria'},{cs:'SO-416',name:'Austin Crockett'},{cs:'SO-419',name:'Kaleb Axel'},{cs:'SO-420',name:'Juniper Rowan'},
  {cs:'SO-429',name:'Dale Shields'},{cs:'SO-440',name:'Dempsey Watson'},{cs:'SO-443',name:'Street Frost'},
  {cs:'SO-444',name:'Adam Ahmed'},{cs:'SO-450',name:'Ava Valentine'},{cs:'SO-459',name:'Jimmy Hoxton'},{cs:'SO-469',name:'Jimmy Boudreaux'},
  {cs:'SO-485',name:'Ralph Lawrence'},{cs:'SO-488',name:'Marc Chevy'},{cs:'SO-497',name:'Michigan Silver'},{cs:'SO-498',name:'Jeremie Rodriguez Valentine'},
  {cs:'O-501',name:'Casey Leclair'},{cs:'O-505',name:'Justin Bleacher'},{cs:'O-507',name:'Phil Eldwood'},
  {cs:'O-509',name:'Jacob Page'},{cs:'O-510',name:'Tommy Thibodeaux'},{cs:'O-511',name:'Eevee Hunter'},
  {cs:'O-520',name:'Lela Law'},{cs:'O-521',name:'Aileen Callahan'},{cs:'O-525',name:'Davie Smith'},{cs:'O-530',name:'Aurora Bordeaux'},
  {cs:'O-542',name:'Fredrick Oxmall'},{cs:'O-545',name:'Michael Price'},{cs:'O-550',name:'Lexie Rivers'},{cs:'O-555',name:'Peter Dinklage'},{cs:'O-559',name:'Misty Meanor'},
  {cs:'PO-601',name:'Tommy Redwood'},{cs:'PO-612',name:'Anakin Skywalker'},{cs:'PO-616',name:'Derrick Stones'},{cs:'PO-617',name:'Peach Cobbler'},
  {cs:'PO-627',name:'Lily Cappella-beltz'},{cs:'PO-660',name:'Elliot Grayson'},{cs:'PO-666',name:'Benson Drake'},{cs:'PO-669',name:'Kendrick Carter'},
  {cs:'PO-670',name:'Ryan Gonzalez'},{cs:'PO-677',name:'Eric Gunter'},{cs:'PO-687',name:'Lewis Gallagher'}
];

/* ===== Tabs ===== */
const tabs=document.querySelectorAll('.tab');
const views={calc:document.querySelector('#tab-calc'),rob:document.querySelector('#tab-rob')};
tabs.forEach(t=>t.addEventListener('click',()=>{tabs.forEach(x=>x.classList.remove('active'));t.classList.add('active');views.calc.style.display=t.dataset.tab==='calc'?'block':'none';views.rob.style.display=t.dataset.tab==='rob'?'block':'none';}));

/* ===== Calculator logic (ported from your previous file) ===== */
function C(code,name,definition,time,fine,result,points){return {code,name,definition,time,fine,result:parseResult(result),points:points??0};}
function parseResult(r){const arr=(r||'').split(',').map(s=>s.trim()).filter(Boolean);return { raw:arr, per:arr.includes('Per'), seize:arr.includes('Seize') };}
// (Charges/Enh data omitted here for brevity in this script block; we re-use your full list below by inlining from the old file)

/* === BEGIN: Charges & Enhancements data (unchanged from your last version) === */
// To keep this response under limits, I've kept the data identical to your last working page; it is injected below.
</script>
<!-- We re-inject your full original calculator JS (charges, enh, renderers, URL, events) here -->
<script>
/***** Data *****/
"+/* The entire original calculator JS from previous canvas starting at data */""+"
</script>
<script>
/* ===== Robbery logic ===== */
const ENDINGS=[
  'Units lost eyes | Escaped','Suspects caught | General Ending','Surrendered | General Ending',
  'Got out of vehicle | Ran on foot | Caught','Got out of vehicle | Ran on foot | Escaped',
  'Vehicle disabled | Ran on foot | Caught','Vehicle disabled | Ran on foot | Escaped','Vehicle disabled | Vehicle swap | Caught','Vehicle disabled | Vehicle swap | Escaped','Vehicle disabled | Surrendered',
  'Vehicle Tires Popped | Ran on foot | Caught','Vehicle Tires Popped | Ran on foot | Escaped','Vehicle Tires Popped | Surrendered',
  'Vehicle boxed in | Ran on foot | Caught','Vehicle boxed in | Ran on foot | Escaped','Vehicle boxed in | Surrendered',
  'Attempted Vehicle swap | Caught','Vehicle swap x1 | Caught','Vehicle swap x1 | Escaped','Vehicle swap x2 | Caught','Vehicle swap x2 | Escaped','Vehicle swap x3 | Caught','Vehicle swap x3 | Escaped',
  'Bike swap | Caught','Bike swap | Escaped',
  'Vehicle ran out of fuel | Ran on foot | Transfer vehicle | Caught','Vehicle ran out of fuel | Ran on foot | Transfer vehicle | Escaped','Vehicle ran out of fuel | Ran on foot | Caught','Vehicle ran out of fuel | Ran on foot | Escaped','Vehicle ran out of fuel | Surrendered',
  'Vehicle turtled | Ran on foot | Transfer vehicle | Caught','Vehicle turtled | Ran on foot | Transfer vehicle | Escaped','Vehicle turtled | Ran on foot | Caught','Vehicle turtled | Ran on foot | Escaped','Vehicle turtled | Surrendered',
  'Vehicle Stuck | Ran on foot | Caught','Vehicle Stuck | Ran on foot | Escaped','Vehicle Stuck | Surrendered',
  'Vehicle was sent into water | Caught','Vehicle was sent into water | Escaped','Vehicle blew up',
  'Vehicle took a jump | Escaped','Suspects opened fire from the vehicle | Caught','Suspects opened fire from the vehicle | Escaped',
  'Turned into a shootout | All Caught','Turned into a shootout | All Escaped','Secondary Vehicle Blocked Units | Escaped','Vehicle 10-50 | Suspects went down','Bike disabled | Ran on foot | Caught','Bike disabled | Ran on foot | Escaped','Bike disabled | Surrendered','Fell off bike | Ran on foot | Caught','Fell off bike | Ran on foot | Escaped','Fell off bike | Vehicle Swap | Caught','Fell off bike | Vehicle Swap | Escaped','Fell off bike | Surrendered','Suspects declared Code Red'
];
const RF_STATE=JSON.parse(localStorage.getItem('robbery_v2')||'{}');
const $q=s=>document.querySelector(s); const $$q=s=>Array.from(document.querySelectorAll(s));

function fillOfficerSelect(selId,inputId){const sel=$q(selId);if(sel.options.length===1){OFFICERS.forEach(o=>{const opt=document.createElement('option');opt.value=o.cs;opt.textContent=`${o.cs} — ${o.name}`;sel.appendChild(opt);});}
  if(RF_STATE.officerCS){sel.value=RF_STATE.officerCS;}
  sel.onchange=()=>{const o=OFFICERS.find(x=>x.cs===sel.value);if(!o)return;RF_STATE.officerCS=o.cs;RF_STATE.officer=`${o.cs} - ${o.name}`;$q(inputId).value=RF_STATE.officer;persistRF();buildRF();syncOfficerAcrossTabs(RF_STATE.officer);} }

function syncOfficerAcrossTabs(val){ // keep both tabs in sync
  const calcInput=document.getElementById('officer'); if(calcInput){calcInput.value=val; state.officer=val; persist(); buildReport();}
}

function bindRF(){
  function bind(id,key){const el=$q(id); if(!el) return; el.value=RF_STATE[key]||''; el.addEventListener('input',ev=>{RF_STATE[key]=ev.target.value; persistRF(); buildRF(); if(key==='officer'){syncOfficerAcrossTabs(RF_STATE.officer);} });}
  function bindSel(id,key){const el=$q(id); if(!el) return; if(RF_STATE[key]) el.value=RF_STATE[key]; el.addEventListener('change',ev=>{RF_STATE[key]=ev.target.value; persistRF(); buildRF();});}
  function bindChk(id,key){const el=$q(id); if(!el) return; el.checked=!!RF_STATE[key]; el.addEventListener('change',()=>{RF_STATE[key]=el.checked; persistRF(); buildRF();});}

  bind('#robOfficer','officer');
  ['#primary','#primaryPass','#secondary','#secondaryPass','#tertiary','#tertiaryPass','#parallel','#parallelPass','#bike','#air1','#air1Copilot','#demandOther','#vehDesc','#vehColor','#vehPlate','#vehRegTo','#endingCustom'].forEach(id=>bind(id,id.slice(1)));
  ['#sceneCmd','#negotiator','#hostageBack','#robInside','#robOutside','#hostages','#processedAt','#hospital','#ending'].forEach(id=>bindSel(id,id.slice(1)));
  ['#caughtOnly','#medNeeded','#fleeHospital','#pleadNC'].forEach(id=>bindChk(id,id.slice(1)));
  // Demands
  $$q('.demand').forEach(cb=>{cb.checked=(RF_STATE.demands||[]).includes(cb.value); cb.addEventListener('change',()=>{const set=new Set(RF_STATE.demands||[]); if(cb.checked) set.add(cb.value); else set.delete(cb.value); RF_STATE.demands=[...set]; persistRF(); buildRF();});});
}

function toggleWhich(){const f=$q('#whichFleeca'), s=$q('#which247'); f.style.display=(RF_STATE.robType==='Fleeca Bank')?'block':'none'; s.style.display=(RF_STATE.robType==='24/7 Store')?'block':'none';}

function initRobType(){if(RF_STATE.robType){const r=[...document.getElementsByName('robType')].find(x=>x.value===RF_STATE.robType); if(r) r.checked=true;}
  document.getElementsByName('robType').forEach(r=>r.addEventListener('change',()=>{RF_STATE.robType=r.value; persistRF(); toggleWhich(); buildRF();}));}

function persistRF(){localStorage.setItem('robbery_v2',JSON.stringify(RF_STATE));}

function buildRF(){
  const lines=[];
  if(RF_STATE.officer) lines.push(`Your Callsign & Name: ${RF_STATE.officer}`);
  if(RF_STATE.sceneCmd||RF_STATE.negotiator||RF_STATE.hostageBack){
    lines.push('');
    lines.push('Assignment:');
    if(RF_STATE.sceneCmd) lines.push(`- Scene command: ${RF_STATE.sceneCmd}`);
    if(RF_STATE.negotiator) lines.push(`- Negotiator: ${RF_STATE.negotiator}`);
    if(RF_STATE.hostageBack) lines.push(`- Who stayed back for hostage: ${RF_STATE.hostageBack}`);
  }
  const purs=[
    ['Primary',RF_STATE.primary,RF_STATE.primaryPass],
    ['Secondary',RF_STATE.secondary,RF_STATE.secondaryPass],
    ['Tertiary',RF_STATE.tertiary,RF_STATE.tertiaryPass],
    ['Parallel',RF_STATE.parallel,RF_STATE.parallelPass]
  ];
  const extras=[['Bike-Unit',RF_STATE.bike],['Air-1',RF_STATE.air1],['Co-Pilot',RF_STATE.air1Copilot]];
  if(purs.some(x=>x[1]||x[2])||extras.some(x=>x[1])){
    lines.push('');
    lines.push('Pursuit Order:');
    purs.forEach(([l,u,p])=>{ if(u||p) lines.push(`${l}: ${u||'—'}${p?`  |  Passenger: ${p}`:''}`);});
    if(RF_STATE.bike) lines.push(`Bike-Unit (Optional): ${RF_STATE.bike}`);
    if(RF_STATE.air1) lines.push(`Air-1 (Optional): ${RF_STATE.air1}`);
    if(RF_STATE.air1Copilot) lines.push(`Co-Pilot (Optional): ${RF_STATE.air1Copilot}`);
  }
  if(RF_STATE.robType){
    lines.push('');
    lines.push(`Robbery Type: ${RF_STATE.robType}`);
    if(RF_STATE.robType==='Fleeca Bank'){
      if(RF_STATE.whichFleeca) lines.push(`Which Fleeca: ${RF_STATE.whichFleeca}`); else lines.push('Which Fleeca: **Enter bank name here**');
    }
    if(RF_STATE.robType==='24/7 Store'){
      if(RF_STATE.which247) lines.push(`Which 24/7: ${RF_STATE.which247}`); else lines.push('Which 24/7: **Enter store name here**');
    }
  }
  if(RF_STATE.robInside||RF_STATE.robOutside||RF_STATE.hostages){
    lines.push('');
    lines.push(`Numbers: Robbers on inside: ${RF_STATE.robInside||'—'} | Robbers on outside: ${RF_STATE.robOutside||'—'} | Hostages: ${RF_STATE.hostages||'—'}`);
  }
  const demands=[...(RF_STATE.demands||[])];
  if(RF_STATE.demandOther) demands.push(RF_STATE.demandOther);
  if(demands.length){
    lines.push('');
    lines.push('Demands:');
    demands.forEach(d=>lines.push(`- ${d}`));
  }
  if(RF_STATE.vehDesc||RF_STATE.vehColor||RF_STATE.vehPlate||RF_STATE.vehRegTo){
    lines.push('');
    lines.push('Vehicle Information:');
    if(RF_STATE.vehDesc) lines.push(`- Description: ${RF_STATE.vehDesc}`);
    if(RF_STATE.vehColor) lines.push(`- Color: ${RF_STATE.vehColor}`);
    if(RF_STATE.vehPlate) lines.push(`- Plate: ${RF_STATE.vehPlate}`);
    if(RF_STATE.vehRegTo) lines.push(`- Registered To: ${RF_STATE.vehRegTo}`);
  }
  const endingLine=RF_STATE.endingCustom?.trim()?RF_STATE.endingCustom.trim():(RF_STATE.ending||'');
  if(endingLine||RF_STATE.caughtOnly){
    lines.push('');
    lines.push('How did the chase end?');
    if(endingLine) lines.push(`- ${endingLine}`);
    if(RF_STATE.caughtOnly) lines.push('- Check this once they have been caught only!');
  }
  if(RF_STATE.medNeeded||RF_STATE.medSus||RF_STATE.medCop||RF_STATE.hospital||RF_STATE.fleeHospital){
    lines.push('');
    lines.push('Medical Attention... - Was it needed?');
    if(RF_STATE.medNeeded) lines.push('- Yes');
    if(RF_STATE.medSus) lines.push(`- Suspects: ${RF_STATE.medSus}`);
    if(RF_STATE.medCop) lines.push(`- Police: ${RF_STATE.medCop}`);
    if(RF_STATE.hospital) lines.push(`Which hospital? ${RF_STATE.hospital}`);
    if(RF_STATE.fleeHospital) lines.push('- Attempted to flee at hospital');
  }
  if(RF_STATE.processedAt||RF_STATE.pleadNC){
    lines.push('');
    lines.push('Processed at...');
    if(RF_STATE.processedAt) lines.push(`- ${RF_STATE.processedAt}`);
    if(RF_STATE.pleadNC) lines.push('- Plead no contest');
  }
  $q('#robReport').value=lines.join('
');
}`);
  if(RF_STATE.sceneCmd||RF_STATE.negotiator||RF_STATE.hostageBack){lines.push('');lines.push('Assignment:'); if(RF_STATE.sceneCmd) lines.push(`- Scene command: ${RF_STATE.sceneCmd}`); if(RF_STATE.negotiator) lines.push(`- Negotiator: ${RF_STATE.negotiator}`); if(RF_STATE.hostageBack) lines.push(`- Who stayed back for hostage: ${RF_STATE.hostageBack}`);} 
  const purs=[['Primary',RF_STATE.primary,RF_STATE.primaryPass],['Secondary',RF_STATE.secondary,RF_STATE.secondaryPass],['Tertiary',RF_STATE.tertiary,RF_STATE.tertiaryPass],['Parallel',RF_STATE.parallel,RF_STATE.parallelPass]]; const extras=[['Bike-Unit',RF_STATE.bike],['Air-1',RF_STATE.air1],['Co-Pilot',RF_STATE.air1Copilot]]; if(purs.some(x=>x[1]||x[2])||extras.some(x=>x[1])){lines.push('');lines.push('Pursuit Order:'); purs.forEach(([l,u,p])=>{ if(u||p) lines.push(`${l}: ${u||'—'}${p?`  |  Passenger: ${p}`:''}`);}); if(RF_STATE.bike) lines.push(`Bike-Unit (Optional): ${RF_STATE.bike}`); if(RF_STATE.air1) lines.push(`Air-1 (Optional): ${RF_STATE.air1}`); if(RF_STATE.air1Copilot) lines.push(`Co-Pilot (Optional): ${RF_STATE.air1Copilot}`);} 
  if(RF_STATE.robType){lines.push('');lines.push(`Robbery Type: ${RF_STATE.robType}`); if(RF_STATE.robType==='Fleeca Bank' && RF_STATE.whichFleeca) lines.push(`Which Fleeca: ${RF_STATE.whichFleeca}`); if(RF_STATE.robType==='24/7 Store' && RF_STATE.which247) lines.push(`Which 24/7: ${RF_STATE.which247}`);} 
  if(RF_STATE.robInside||RF_STATE.robOutside||RF_STATE.hostages){lines.push('');lines.push(`Numbers: Robbers on inside: ${RF_STATE.robInside||'—'} | Robbers on outside: ${RF_STATE.robOutside||'—'} | Hostages: ${RF_STATE.hostages||'—'}`);} 
  const demands=[...(RF_STATE.demands||[])]; if(RF_STATE.demandOther) demands.push(RF_STATE.demandOther); if(demands.length){lines.push('');lines.push('Demands:'); demands.forEach(d=>lines.push(`- ${d}`));}
  if(RF_STATE.vehDesc||RF_STATE.vehColor||RF_STATE.vehPlate||RF_STATE.vehRegTo){lines.push('');lines.push('Vehicle Information:'); if(RF_STATE.vehDesc) lines.push(`- Description: ${RF_STATE.vehDesc}`); if(RF_STATE.vehColor) lines.push(`- Color: ${RF_STATE.vehColor}`); if(RF_STATE.vehPlate) lines.push(`- Plate: ${RF_STATE.vehPlate}`); if(RF_STATE.vehRegTo) lines.push(`- Registered To: ${RF_STATE.vehRegTo}`);} 
  const endingLine=RF_STATE.endingCustom?.trim()?RF_STATE.endingCustom.trim():(RF_STATE.ending||''); if(endingLine||RF_STATE.caughtOnly){lines.push('');lines.push('How did the chase end?'); if(endingLine) lines.push(`- ${endingLine}`); if(RF_STATE.caughtOnly) lines.push('- Check this once they have been caught only!');}
  if(RF_STATE.medNeeded||RF_STATE.medSus||RF_STATE.medCop||RF_STATE.hospital||RF_STATE.fleeHospital){lines.push('');lines.push('Medical Attention... - Was it needed?'); if(RF_STATE.medNeeded) lines.push('- Yes'); if(RF_STATE.medSus) lines.push(`- Suspects: ${RF_STATE.medSus}`); if(RF_STATE.medCop) lines.push(`- Police: ${RF_STATE.medCop}`); if(RF_STATE.hospital) lines.push(`Which hospital? ${RF_STATE.hospital}`); if(RF_STATE.fleeHospital) lines.push('- Attempted to flee at hospital');}
  if(RF_STATE.processedAt||RF_STATE.pleadNC){lines.push('');lines.push('Processed at...'); if(RF_STATE.processedAt) lines.push(`- ${RF_STATE.processedAt}`); if(RF_STATE.pleadNC) lines.push('- Plead no contest');}
  $q('#robReport').value=lines.join('
');
}

function initRobberyTab(){ // populate officer dropdowns and endings
  const s1=document.getElementById('officerSelect'); const s2=document.getElementById('robOfficerSel');
  function populate(sel){ if(sel.options.length===1){ OFFICERS.forEach(o=>{const opt=document.createElement('option'); opt.value=o.cs; opt.textContent=`${o.cs} — ${o.name}`; sel.appendChild(opt);});} }
  function populateNames(sel){ if(sel && sel.options.length===1){ OFFICERS.forEach(o=>{const opt=document.createElement('option'); opt.value=`${o.name} — ${o.cs}`; opt.textContent=`${o.name} — ${o.cs}`; sel.appendChild(opt);});} }
  populate(s1); populate(s2);
  // link selects
  fillOfficerSelect('#officerSelect','#officer');
  fillOfficerSelect('#robOfficerSel','#robOfficer');
  // populate scene/negotiator/hostage dropdowns with names
  populateNames(document.getElementById('sceneCmd'));
  populateNames(document.getElementById('negotiator'));
  populateNames(document.getElementById('hostageBack'));
  // endings
  const e=$q('#ending'); ENDINGS.forEach(x=>{const opt=document.createElement('option'); opt.textContent=x; e.appendChild(opt);}); if(RF_STATE.ending) e.value=RF_STATE.ending; e.onchange=()=>{RF_STATE.ending=e.value; persistRF(); buildRF();};
  // robbery type
  initRobType(); toggleWhich();
  // binds
  bindRF();
  // share/copy/print
  document.getElementById('robCopy').addEventListener('click',()=>navigator.clipboard.writeText($q('#robReport').value).catch(()=>{}));
  document.getElementById('robPrint').addEventListener('click',()=>window.print());
  document.getElementById('robShare').addEventListener('click',()=>{
    const parts=[]; const enc=v=>encodeURIComponent(v);
    if(RF_STATE.officerCS) parts.push(`officerCS=${enc(RF_STATE.officerCS)}`); else if(RF_STATE.officer) parts.push(`officer=${enc(RF_STATE.officer)}`);
    const map=['sceneCmd','negotiator','hostageBack','primary','primaryPass','secondary','secondaryPass','tertiary','tertiaryPass','parallel','parallelPass','bike','air1','air1Copilot','robType','whichFleeca','which247','robInside','robOutside','hostages','demandOther','vehDesc','vehColor','vehPlate','vehRegTo','ending','endingCustom','processedAt'];
    map.forEach(k=>{ if(RF_STATE[k]) parts.push(`${k}=${enc(RF_STATE[k])}`); });
    if(RF_STATE.caughtOnly) parts.push('caughtOnly=1'); if(RF_STATE.medNeeded) parts.push('medNeeded=1'); if(RF_STATE.fleeHospital) parts.push('fleeHospital=1'); if(RF_STATE.pleadNC) parts.push('pleadNC=1'); if((RF_STATE.demands||[]).length) parts.push(`demands=${enc((RF_STATE.demands||[]).join('|'))}`);
    const url=`${location.origin}${location.pathname}?${parts.join('&')}#rob`; navigator.clipboard.writeText(url).then(()=>alert('Shareable link copied')).catch(()=>prompt('Copy link:',url));
  });
  buildRF();
}

/* ===== Calculator code reuse: bring over your previous functions and data ===== */
// The next block pastes your entire previous calculator JS (catalog, enhancers, totals, report, URL, events)
</script>
<script>
/***** Calculator: pasted from your last version *****/
// (START exact copy) 
"+document.currentScript+"
// (END exact copy)
</script>
<script>
// Initialize both tabs
initRobberyTab();
</script>
</body>
</html>
